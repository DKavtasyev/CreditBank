Микросервис Statement выполняет следующие функции:
1) принимает заявку на кредит от пользователя, осуществляет её прескоринг, после чего отсылает запрос на расчёт предварительных условий кредита в
микросервис Deal, принимает четыре условия кредита с разными опциями: заплатный клиент, страховка включена, и возвращает
эти опции клиенту для выбора.
2) принимает выбранный пользователем вариант кредита, отсылает его в микросервис Deal для записи в БД.

Первая функция реализована в методе getLoanOffers(LoanStatementRequestDto loanStatementRequestDto) REST-контроллера
StatementController. В этом методе вызывается соответствующий метод сервиса getLoanOffers(LoanStatementRequestDto loanStatementRequestDto),
который возвращает ArrayList с четырьмя вариантами предварительно рассчитанных условий кредита. Метод getLoanOffers
сервиса вызывает метод requestLoanOffers(LoanStatementRequestDto loanStatementRequestDto) сервиса DealRequester, который
осуществляет подзапрос в микросервис Deal, используя RestTemplate. Если пользователь с указанными серией и номером
паспорта был ранее сохранён в БД, в случае несовпадения отправленных паспортных данных с ФИО пользователя из базы данных,
микросервис Deal отсылает статус 405 с сообщением об ошибке, которое обрабатывается в сервисе DealRequester и кидается
исключение InvalidPassportDataException с таким же сообщением об ошибке, при этом МС Statement также отсылает статус 405.
В случае получения предложений кредита со статусом 200, метод requestLoanOffers возвращает ArrayList с предварительно
рассчитанными предложениями.

Вторая функция реализована в методе applyOffer(LoanOfferDto loanOfferDto) REST-контроллера StatementController. В этом
методе вызывается метод applyChosenOffer(LoanOfferDto loanOfferDto) сервиса StatementService, в котором вызывается
метод sendChosenOffer(LoanOfferDto loanOfferDto) сервиса DealRequester. В этом методе осуществляется подзапрос в микросервис
Deal с использованием RestTemplate и принимается один из трёх ответов:
- response со статусом 200, с пустым телом ответа;
- response со статусом 404 с сообщением об ошибке в теле ответа - в случае отсутствия в базе данных Statement с указанным
в подзапросе в выбранном предложении кредита statementId. В этом случае кидается исключение StatementNotFoundException
с сообщением об ошибке из полученного ответа, которое обрабатывается в глобальном обработчике исключений
GlobalExceptionHandler, при этом пользователю также отсылается статус 404 с сообщением об ошибке.